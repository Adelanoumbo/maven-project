pipeline {
    agent none 
     options {
      buildDiscarder(logRotator(numToKeepStr: '20'))
      disableConcurrentBuilds()
      timeout (time: 10, unit: 'MINUTES')
      timestamps()
    }
    stages {
        stage('maven clean') {
            agent {
                docker{
                    image 'maven'
                }
            }
            steps {
                sh  'mvn clean'
            }
        }


       stage('Sonar Test') {
            agent {
                docker{
                    image 'maven'
                }
            }
            steps {
                withSonarQubeEnv('Sonar') {
                 sh  'mvn clean sonar:sonar'
                }
                
            }
        }



       stage('maven build') {
            agent {
                docker{
                    image 'maven:3-ibmjava-8-alpine'
                }
            }
            steps {
                sh  'mvn clean install package'
            }
        }



    }
}
